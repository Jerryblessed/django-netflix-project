{% load static %}
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Netflix</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js" integrity="sha384-3LK/3kTpDE/Pkp8gTNp2gR/2gOiwQ6QaO7Td0zV76UFJVhqLl4Vl3KL1We6q6wR9" crossorigin="anonymous"></script>
  <script src="main.js"></script>
  <link rel="stylesheet" href="{% static 'netflix/style.css' %}">
</head>
<body>
  <div class="wrapper">

    <!-- HEADER -->
    <header>
      <div class="netflixLogo">
        <a id="logo" href="#home"><img src="https://github.com/carlosavilae/Netflix-Clone/blob/master/img/logo.PNG?raw=true" alt="Logo Image"></a>
      </div>      
      <nav class="main-nav">                
        <a href="#home">Home</a>
        <a href="#tvShows">TV Shows</a>
        <a href="#movies">Movies</a>
        <a href="#originals">Originals</a>
        <a href="#">Recently Added</a>
        <a target="_blank" href="https://codepen.io/cb2307/full/NzaOrm">Portfolio</a>        
      </nav>
      <nav class="sub-nav">
        <a href="#"><i class="fas fa-search sub-nav-logo"></i></a>
        <a href="#"><i class="fas fa-bell sub-nav-logo"></i></a>
        {% if request.user.is_authenticated %}
          {{ request.user }}
          <a href="/logout"><i class="fas fa-power-off sub-nav-logo"></i>Logout</a>
        {% else %}
          <a href="/register">Register</a><a href="/login">Login</a>
        {% endif %}
      </nav>      
    </header>
    <!-- END OF HEADER -->
    
    <!-- MAIN CONTAINER -->
<section class="main-container">
  {% if movie %}
    <h3 style="padding: 15px">{{ movie.name }}</h3>
    <h3 style="padding: 15px">{{ movie.category }}</h3>
    <video width="100%" height="70%" controls>
      <source src="/media/{{ movie.file }}" type="video/mp4">
    </video>
    <div style="padding: 15px;">
      <button id="like-btn" onclick="toggleLike()">Like</button>
      <span id="likes-count">{{ movie.like_set.count }}</span> likes
    </div>
  {% else %}
    <strong style="font-size: 25px">Invalid URL</strong>
  {% endif %}
</section>


<h1>{{ movie.name }}</h1>
<img src="{{ movie.preview_image.url }}" alt="{{ movie.name }}">
<p>{{ movie.description }}</p>
<p>Resolution: {{ movie.get_resolution_display }}</p>
<a href="{{ movie.file.url }}">Download/Play</a>


<script>
function toggleLike() {
  fetch(`/like/{{ movie.id }}/`, { method: 'POST', credentials: 'same-origin', headers: {'X-CSRFToken': '{{ csrf_token }}'}})
    .then(response => response.json())
    .then(data => {
      if (data.likes_count !== undefined) {
        document.getElementById('likes-count').textContent = data.likes_count;
        document.getElementById('like-btn').textContent = data.message === 'Movie liked' ? 'Unlike' : 'Like';
      } else {
        alert(data.error || 'An error occurred');
      }
    });
}
</script>

  </div>
</body>
</html>
